clear
close all

% Construct finite differences operators for a 2D ploblem of size (4x3)
[Dx,Dy,L] = finite_differences_2D(4,3);  

% Comparison with ground truth
Dx_GT = [...
    -1     0     0     0     1     0     0     0     0     0     0     0;...
     0    -1     0     0     0     1     0     0     0     0     0     0;...
     0     0    -1     0     0     0     1     0     0     0     0     0;...
     0     0     0    -1     0     0     0     1     0     0     0     0;...
     0     0     0     0    -1     0     0     0     1     0     0     0;...
     0     0     0     0     0    -1     0     0     0     1     0     0;...
     0     0     0     0     0     0    -1     0     0     0     1     0;...
     0     0     0     0     0     0     0    -1     0     0     0     1;...
     0     0     0     0     0     0     0     0     0     0     0     0;...
     0     0     0     0     0     0     0     0     0     0     0     0;...
     0     0     0     0     0     0     0     0     0     0     0     0;...
     0     0     0     0     0     0     0     0     0     0     0     0]; 

nb_errors_Dx = sum(full(Dx(:))~=Dx_GT(:));
disp(sprintf('Nb of errors in Dx: %d over 12 coefficients',nb_errors_Dx));

Dy_GT = [...
    -1     1     0     0     0     0     0     0     0     0     0     0;...
     0    -1     1     0     0     0     0     0     0     0     0     0;...
     0     0    -1     1     0     0     0     0     0     0     0     0;...
     0     0     0     0     0     0     0     0     0     0     0     0;...
     0     0     0     0    -1     1     0     0     0     0     0     0;...
     0     0     0     0     0    -1     1     0     0     0     0     0;...
     0     0     0     0     0     0    -1     1     0     0     0     0;...
     0     0     0     0     0     0     0     0     0     0     0     0;...
     0     0     0     0     0     0     0     0    -1     1     0     0;...
     0     0     0     0     0     0     0     0     0    -1     1     0;...
     0     0     0     0     0     0     0     0     0     0    -1     1;...
     0     0     0     0     0     0     0     0     0     0     0     0]; 
     
nb_errors_Dy = sum(full(Dy(:))~=Dy_GT(:));
disp(sprintf('Nb of errors in Dy: %d over 12 coefficients',nb_errors_Dy));

L_GT = [...
    -2     1     0     0     1     0     0     0     0     0     0     0;...
     1    -3     1     0     0     1     0     0     0     0     0     0;...
     0     1    -3     1     0     0     1     0     0     0     0     0;...
     0     0     1    -2     0     0     0     1     0     0     0     0;...
     1     0     0     0    -3     1     0     0     1     0     0     0;...
     0     1     0     0     1    -4     1     0     0     1     0     0;...
     0     0     1     0     0     1    -4     1     0     0     1     0;...
     0     0     0     1     0     0     1    -3     0     0     0     1;...
     0     0     0     0     1     0     0     0    -2     1     0     0;...
     0     0     0     0     0     1     0     0     1    -3     1     0;...
     0     0     0     0     0     0     1     0     0     1    -3     1;...
     0     0     0     0     0     0     0     1     0     0     1    -2];

nb_errors_L = sum(full(L(:))~=L_GT(:));
disp(sprintf('Nb of errors in L: %d over 12 coefficients',nb_errors_L));

% Test on larger problems
t0 = tic;
[Dx,Dy,L] = finite_differences_2D(256,256);
t1 = toc(t0);  
disp(sprintf('Time for discretizing a 256x256 problem: %.2f seconds',t1));

t0 = tic;
[Dx,Dy,L] = finite_differences_2D(800,600);
t1 = toc(t0);  
disp(sprintf('Time for discretizing a 800x600 problem: %.2f seconds',t1));

t0 = tic;
[Dx,Dy,L] = finite_differences_2D(1920,1080);
t1 = toc(t0);  
disp(sprintf('Time for discretizing a 1920x1080 problem: %.2f seconds',t1));

t0 = tic;
[Dx,Dy,L] = finite_differences_2D(3840,2160);
t1 = toc(t0);  
disp(sprintf('Time for discretizing a 3840x2160 problem: %.2f seconds',t1));
